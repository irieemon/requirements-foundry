---
phase: 10-navigation-layout
plan: 01
type: execute
domain: frontend
---

<objective>
Enhance sidebar with contextual project navigation showing project sections when viewing a project.

Purpose: Transform the flat 2-item sidebar into context-aware navigation that expands when viewing project details, making section switching intuitive.
Output: Enhanced sidebar component with project-scoped secondary navigation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/STRUCTURE.md
@.planning/codebase/CONVENTIONS.md

**Key files:**
@components/layout/sidebar.tsx
@components/layout/mobile-nav.tsx
@components/layout/app-shell.tsx
@app/projects/[id]/page.tsx

**Established patterns:**
- Dark sidebar with light content canvas
- Collapsible sidebar with localStorage persistence
- TooltipProvider for collapsed state labels
- Section navigation via KPI cards with query params (?section=uploads)

**Constraints:**
- Keep existing shadcn/ui components
- Maintain dark sidebar theme
- Preserve collapse/expand functionality
- Section list: uploads, cards, epics, stories, subtasks, runs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add project context detection to sidebar</name>
  <files>components/layout/sidebar.tsx</files>
  <action>
    1. Import usePathname from next/navigation
    2. Detect when pathname matches /projects/[id] pattern (regex: /^\/projects\/([^\/]+)/)
    3. Extract projectId from path when on project pages
    4. Create state/prop for current project context
    5. Conditionally render project section nav items when projectId exists:
       - Uploads (FileText icon)
       - Cards (Layers icon)
       - Epics (BookOpen icon)
       - Stories (ScrollText icon)
       - Subtasks (ListTodo icon)
       - Runs (Activity icon)
    6. Use visual hierarchy: primary nav items full width, project sections indented with smaller text
    7. Project section links should use the query param pattern: /projects/${projectId}?section=${section}
    8. Mark section as active when searchParams.get('section') matches (default to 'uploads')

    AVOID: Creating separate component files - keep this in sidebar.tsx for now. Phase 11 may refactor if complexity grows.
  </action>
  <verify>
    1. Visit /projects - sidebar shows only Projects and Runs
    2. Visit /projects/[id] - sidebar shows Projects, Runs, AND project sections
    3. Click section links - URL updates with ?section=X, page shows that section
  </verify>
  <done>
    - Sidebar shows project sections only when viewing a project
    - Section links work and highlight correctly
    - Collapsed state shows icons with tooltips for sections
  </done>
</task>

<task type="auto">
  <name>Task 2: Add visual hierarchy to sidebar sections</name>
  <files>components/layout/sidebar.tsx, app/globals.css</files>
  <action>
    1. Add visual separator between main nav and project sections (subtle border or spacing)
    2. Add project name header above sections when expanded (truncated, muted text)
    3. Style project sections with:
       - Left indent (pl-4) when expanded
       - Smaller text (text-xs) compared to main nav (text-sm)
       - Slightly reduced icon size (h-4 w-4 vs h-5 w-5)
       - Muted color until hover
    4. When collapsed:
       - Show divider line
       - Section icons should still align with main nav icons
       - Tooltips should show "{Section} - {ProjectName}" format

    AVOID: Over-engineering with complex animations. Simple hover states are sufficient.
  </action>
  <verify>
    1. Clear visual distinction between main nav (Projects, Runs) and project sections
    2. Project name visible when expanded
    3. Hover states work correctly for all items
    4. Collapsed mode looks balanced with proper alignment
  </verify>
  <done>
    - Clear visual hierarchy between primary and secondary nav
    - Project context header visible when expanded
    - Consistent styling in both expanded and collapsed states
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Enhanced sidebar with contextual project navigation</what-built>
  <how-to-verify>
    1. Run: npm run dev (or check Vercel preview)
    2. Visit: /projects - Confirm sidebar shows only Projects and Runs
    3. Click any project to open it
    4. Confirm: Sidebar now shows project sections below main nav
    5. Test: Click each section link - page content changes, URL updates
    6. Test: Toggle sidebar collapse - icons show for sections, tooltips work
    7. Test: Navigate to /runs - project sections should disappear
    8. Test: Return to project - sections should reappear
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Sidebar shows project sections only on project pages
- [ ] Section navigation updates URL and page content
- [ ] Visual hierarchy is clear between primary and secondary nav
- [ ] Collapsed state works with tooltips
- [ ] Mobile nav unaffected (handled in separate plan)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Sidebar intelligently shows contextual navigation
- No TypeScript errors
- User confirmed visual verification
</success_criteria>

<output>
After completion, create `.planning/phases/10-navigation-layout/10-01-SUMMARY.md`
</output>
