---
phase: 14-mss-management-ui
plan: 03
type: execute
---

<objective>
Add create, edit, and delete dialogs for individual MSS entries at all levels.

Purpose: Enable users to manually add, modify, and remove individual L2/L3/L4 entries.
Output: Full CRUD capability for MSS taxonomy with inline add buttons and row-level edit/delete.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans in this phase:
@.planning/phases/14-mss-management-ui/14-01-PLAN.md
@.planning/phases/14-mss-management-ui/14-02-PLAN.md

# Server actions (created in Plan 01):
@server/actions/mss.ts

# UI patterns to follow:
@components/projects/create-project-dialog.tsx
@components/mss/mss-service-line-item.tsx

**Tech stack available:** Next.js App Router, shadcn/ui, Prisma, Server Actions
**Established patterns:** Dialog with form, inline actions, confirmation dialogs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create entry dialogs for L2/L3/L4</name>
  <files>components/mss/mss-entry-dialog.tsx, components/mss/mss-service-line-item.tsx, components/mss/mss-hierarchy-viewer.tsx</files>
  <action>
**Create components/mss/mss-entry-dialog.tsx:**
A single reusable dialog component for creating entries at any level.

Props:
- level: "L2" | "L3" | "L4"
- parentId?: string (required for L3/L4 - the parent's id)
- parentName?: string (for context in title: "Add Service Area to {parentName}")
- trigger: ReactNode (the button that opens dialog)
- onSuccess: () => void (callback to refresh data)

Dialog content based on level:
- Title: "Add Service Line" / "Add Service Area" / "Add Activity"
- Form fields: Code (required), Name (required), Description (optional textarea)
- Validation: Code and Name required, Code should be uppercase alphanumeric

On submit:
- L2: Call createServiceLine({ code, name, description })
- L3: Call createServiceArea({ serviceLineId: parentId, code, name, description })
- L4: Call createActivity({ serviceAreaId: parentId, code, name, description })
- Handle errors (especially unique constraint: "Code already exists")
- Toast success, close dialog, call onSuccess

**Update components/mss/mss-hierarchy-viewer.tsx:**
- Add "Add Service Line" button at top (triggers L2 dialog)
- Pass onSuccess that calls router.refresh()

**Update components/mss/mss-service-line-item.tsx:**
- Add "+" button on L2 row header (creates L3 under this L2)
- Add "+" button on L3 row (creates L4 under this L3)
- Each triggers MssEntryDialog with appropriate level and parentId

**Button styling:**
- Plus buttons: ghost variant, small size, appears on hover or always visible
- Use Plus icon from lucide-react
  </action>
  <verify>npm run build passes without errors</verify>
  <done>Create dialogs work for all three levels with proper parent relationships</done>
</task>

<task type="auto">
  <name>Task 2: Edit and delete dialogs</name>
  <files>components/mss/mss-edit-dialog.tsx, components/mss/mss-delete-dialog.tsx, components/mss/mss-service-line-item.tsx</files>
  <action>
**Create components/mss/mss-edit-dialog.tsx:**
Similar structure to entry dialog but for editing existing items.

Props:
- level: "L2" | "L3" | "L4"
- item: { id: string; code: string; name: string; description?: string }
- trigger: ReactNode
- onSuccess: () => void

Dialog content:
- Title: "Edit Service Line" / "Edit Service Area" / "Edit Activity"
- Pre-populated form fields
- Code field: readonly (codes shouldn't change - they may be referenced)
- Name and Description editable

On submit:
- L2: updateServiceLine(id, { name, description })
- L3: updateServiceArea(id, { name, description })
- L4: updateActivity(id, { name, description })
- Toast, close, refresh

**Create components/mss/mss-delete-dialog.tsx:**
Confirmation dialog for deleting an entry.

Props:
- level: "L2" | "L3" | "L4"
- item: { id: string; code: string; name: string }
- childCount?: number (for cascade warning)
- trigger: ReactNode
- onSuccess: () => void

Dialog content:
- AlertDialog (destructive)
- Title: "Delete {item.name}?"
- For L2: "This will also delete X service areas and Y activities."
- For L3: "This will also delete X activities."
- For L4: Simple confirmation

On confirm:
- L2: deleteServiceLine(id)
- L3: deleteServiceArea(id)
- L4: deleteActivity(id)
- Toast, close, refresh

**Update components/mss/mss-service-line-item.tsx:**
- Replace disabled Edit/Delete buttons with working dialogs
- Edit button: Pencil icon, opens MssEditDialog
- Delete button: Trash2 icon, opens MssDeleteDialog
- Buttons appear on row hover or always visible
- Pass appropriate level and item data to each dialog

**Button styling:**
- Icon buttons, ghost variant, small
- Delete button: text-destructive on hover
  </action>
  <verify>npm run build passes without errors</verify>
  <done>Edit and delete dialogs work for all levels with cascade warnings</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete CRUD interface for MSS taxonomy management</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/mss
    3. Test CREATE:
       - Click "Add Service Line" - create new L2 entry
       - Expand L2, click "+" to add L3 under it
       - Expand L3, click "+" to add L4 under it
       - Verify hierarchy updates after each add
    4. Test EDIT:
       - Click Edit (pencil) on an L2 - modify name - save
       - Verify name updates in hierarchy
       - Repeat for L3 and L4
    5. Test DELETE:
       - Create a test L2 with L3 children
       - Try to delete L4 first - verify simple confirmation
       - Delete L3 - verify cascade warning shows L4 count
       - Delete L2 - verify cascade warning shows L3/L4 counts
       - Verify items removed from hierarchy
    6. Test validation:
       - Try to create with empty code - should show error
       - Try to create L2 with duplicate code - should show error
    7. Verify no console errors throughout
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Create works for L2, L3, L4 with proper parent linking
- [ ] Edit updates name/description while preserving code
- [ ] Delete shows cascade warnings and removes items
- [ ] Validation prevents empty/duplicate codes
- [ ] Human verified full CRUD flow
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verified complete CRUD functionality
- No TypeScript errors
- Phase 14 complete
</success_criteria>

<output>
After completion, create `.planning/phases/14-mss-management-ui/14-03-SUMMARY.md`

Final summary should note:
- Phase 14 complete
- Full MSS management UI: view hierarchy, import CSV, CRUD operations
- Ready for Phase 15: MSS Mapping to Work Items
</output>
