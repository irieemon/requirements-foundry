---
phase: 11-data-display-hierarchy
plan: 02
type: execute
---

<objective>
Replace story tables with card-based layout for better visual hierarchy.

Purpose: Stories are the middle layer of the hierarchy. Converting from tables to cards creates visual consistency with epics and makes the subtask relationship clearer.
Output: StoryCard component with expandable details, subtask count indicator, and modern styling matching epic cards.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-data-display-hierarchy/11-01-SUMMARY.md (after Plan 01)
@components/stories/story-table.tsx
@components/stories/stories-section.tsx
@components/ui/collapsible.tsx

**Current state:**
- Stories displayed in tables grouped by epic
- Expandable rows show user story, acceptance criteria, technical notes
- Full detail dialog available

**Design direction:**
- Card layout for each story (stacked vertically within each epic group)
- Collapsible card body for acceptance criteria and details
- Show subtask count if story has subtasks
- Priority badge uses same color coding as epic impact
- Keep epic grouping with section headers
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StoryCard component</name>
  <files>components/stories/story-card.tsx</files>
  <action>
Create StoryCard component with expandable content:

1. Structure:
   - Header row: Code badge + Title + Priority badge + Effort badge
   - Collapsed: Shows persona tag and subtask count if > 0
   - User story text as secondary line (truncated when collapsed)
   - Expandable section: Full user story, acceptance criteria list, technical notes

2. Use Collapsible from shadcn/ui:
   ```tsx
   <Collapsible>
     <CollapsibleTrigger asChild>
       <Card className="cursor-pointer">
         {/* header content */}
         <ChevronDown className="h-4 w-4 transition-transform" />
       </Card>
     </CollapsibleTrigger>
     <CollapsibleContent>
       {/* expanded details */}
     </CollapsibleContent>
   </Collapsible>
   ```

3. Styling:
   - Card: `border-border/40 hover:border-border`
   - Expanded content: `bg-muted/30 rounded-b-lg px-4 py-3`
   - Acceptance criteria: bullet list with `text-sm text-muted-foreground`

4. Priority color coding (same as epic impact):
   - Must: `text-red-600 bg-red-50`
   - Should: `text-amber-600 bg-amber-50`
   - Could: `text-blue-600 bg-blue-50`
   - Won't: `text-slate-600 bg-slate-100`

5. Subtask count indicator:
   - If story has subtasks (pass via prop), show badge: `{N} subtasks`
   - Use secondary badge variant

Props interface:
```typescript
interface StoryCardProps {
  story: {
    id: string;
    code: string;
    title: string;
    userStory: string;
    persona: string | null;
    acceptanceCriteria: string | null;
    technicalNotes: string | null;
    priority: string | null;
    effort: string | null;
  };
  subtaskCount?: number;
}
```
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>StoryCard component exists with collapsible details and modern styling</done>
</task>

<task type="auto">
  <name>Task 2: Update StoriesSection to use StoryCard</name>
  <files>components/stories/stories-section.tsx</files>
  <action>
1. Import StoryCard component
2. Replace `<StoryTable stories={epic.stories} />` with mapped StoryCards:
   ```tsx
   <div className="space-y-3">
     {epic.stories.map(story => (
       <StoryCard
         key={story.id}
         story={story}
         subtaskCount={story._count?.subtasks || 0}
       />
     ))}
   </div>
   ```

3. Update the epic grouping Card:
   - Keep CardHeader with epic code badge and title
   - Simplify CardDescription to just "{N} stories"
   - CardContent contains the StoryCard list

4. Update the Story interface in StoriesSection to include `_count?: { subtasks: number }`

5. Keep the empty state unchanged (EmptyState component)
  </action>
  <verify>`npm run build` succeeds</verify>
  <done>StoriesSection displays stories as cards instead of tables</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Card-based story display with collapsible details</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Navigate to a project with stories
    3. Click "Stories" in KPI strip
    4. Verify:
       - Stories appear as individual cards within epic groups
       - Each card shows code, title, priority, effort
       - Clicking a card expands to show user story, acceptance criteria, technical notes
       - Subtask count badge appears on stories that have subtasks
       - Priority badges use appropriate colors
    5. Expand/collapse several cards to verify smooth transitions
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Story cards render correctly within epic groups
- [ ] Expand/collapse works smoothly
- [ ] Subtask counts display when applicable
- [ ] No console errors
</verification>

<success_criteria>

- Stories display as expandable cards instead of tables
- Card styling matches epic cards (consistent design language)
- Subtask count visible on stories that have them
- Priority badges color-coded
- Collapsible content smooth and accessible
</success_criteria>

<output>
After completion, create `.planning/phases/11-data-display-hierarchy/11-02-SUMMARY.md`:

# Phase 11 Plan 02: Story Card Layout Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 11-03-PLAN.md (Subtask Display Polish)
</output>
