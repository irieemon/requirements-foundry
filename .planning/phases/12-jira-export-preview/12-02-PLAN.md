---
phase: 12-jira-export-preview
plan: 02
type: execute
---

<objective>
Integrate the export preview into the wizard and verify the complete experience.

Purpose: Give users a clear view of what they're exporting before download, completing the v1.1 UX polish milestone.
Output: Export wizard Step 3 with tabbed interface showing Preview, Validation, and Download sections.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior plan:**
@.planning/phases/12-jira-export-preview/12-01-SUMMARY.md

**Key files:**
@components/export/export-wizard.tsx
@components/export/validate-download.tsx
@server/actions/jira-export.ts
@components/export/export-preview-tree.tsx

**Established patterns:** Tabs component from shadcn/ui, Card layouts, loading states with Loader2
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tabbed preview to ValidateDownload</name>
  <files>components/export/validate-download.tsx</files>
  <action>
Refactor ValidateDownload to include a tabbed interface with Preview, Validation, and Download sections.

1. Add imports:
```typescript
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { ExportPreviewTree } from "./export-preview-tree";
import { getFullPreviewItems } from "@/server/actions/jira-export";
import type { PreviewItem } from "@/lib/export/jira/types";
```

2. Add state for preview items:
```typescript
const [previewItems, setPreviewItems] = useState<PreviewItem[]>([]);
const [loadingPreview, setLoadingPreview] = useState(true);
```

3. Add useEffect to load preview items when component mounts:
```typescript
useEffect(() => {
  loadPreviewData();
}, []);

const loadPreviewData = async () => {
  setLoadingPreview(true);
  try {
    const data = await getFullPreviewItems(projectId, config);
    setPreviewItems(data.items);
  } catch (error) {
    console.error("Failed to load preview:", error);
  } finally {
    setLoadingPreview(false);
  }
};
```

4. Replace current layout with Tabs:
```tsx
<Tabs defaultValue="preview" className="space-y-4">
  <TabsList className="grid w-full grid-cols-3">
    <TabsTrigger value="preview">
      Preview ({stats.totalRows} items)
    </TabsTrigger>
    <TabsTrigger value="validation">
      Validation {hasErrors ? "⚠" : hasWarnings ? "!" : "✓"}
    </TabsTrigger>
    <TabsTrigger value="download">
      Download
    </TabsTrigger>
  </TabsList>

  <TabsContent value="preview">
    <Card>
      <CardHeader>
        <CardTitle>Export Preview</CardTitle>
        <CardDescription>
          Review the {stats.totalRows} items that will be exported to JIRA
        </CardDescription>
      </CardHeader>
      <CardContent>
        <ExportPreviewTree items={previewItems} loading={loadingPreview} />
      </CardContent>
    </Card>
  </TabsContent>

  <TabsContent value="validation">
    {/* Move existing validation alerts here */}
  </TabsContent>

  <TabsContent value="download">
    {/* Move existing download buttons and bundle info here */}
  </TabsContent>
</Tabs>
```

5. Keep Export Summary stats visible above tabs (always visible context).

Styling:
- Default to "preview" tab so users see data first
- Validation tab shows indicator: red icon if errors, amber if warnings, green if clean
- Download tab only enabled when validation passes

Avoid: Don't change the download logic - just reorganize the UI. Don't remove any existing functionality.
  </action>
  <verify>
Component renders with three tabs.
Preview tab shows ExportPreviewTree with items.
Validation tab shows all errors/warnings.
Download tab has all download buttons.
Tab switching works smoothly.
  </verify>
  <done>
ValidateDownload displays tabbed interface with Preview as default, all existing functionality preserved, preview tree shows export items.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete JIRA export preview experience with tabbed interface showing items before download</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Navigate to a project with epics, stories, and subtasks
    3. Go to Export (from project page or sidebar)
    4. Complete Step 1 (Scope) - select "All epics" or specific epics
    5. Complete Step 2 (Format) - use defaults
    6. Step 3 should show tabbed interface:
       - **Preview tab** (default): Verify tree shows all epics, expandable to see stories/subtasks
       - **Validation tab**: Verify errors/warnings display correctly
       - **Download tab**: Verify all download buttons work
    7. Confirm:
       - Preview accurately reflects selected scope
       - Hierarchy is clear (epic → story → subtask)
       - Counts in tab match actual items
       - Visual style consistent with Phase 11 card patterns
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] Export wizard displays preview tab correctly
- [ ] Human verification of complete UX approved
</verification>

<success_criteria>
- Export wizard Step 3 has tabbed interface
- Preview tab shows full item hierarchy
- Validation and Download tabs preserve all existing functionality
- UX approved via human verification
- Phase 12 complete, v1.1 milestone complete
</success_criteria>

<output>
After completion, create `.planning/phases/12-jira-export-preview/12-02-SUMMARY.md`

Additionally, update:
- `.planning/STATE.md` - Mark Phase 12 complete, v1.1 milestone complete
- `.planning/ROADMAP.md` - Check off Phase 12
</output>
