---
phase: 17-mss-export-integration
plan: 01
type: execute
---

<objective>
Include MSS (Master Service Schedule) mappings in JIRA export so service area context appears in exported descriptions.

Purpose: When work items are exported to JIRA, include the MSS service area assignment so teams can see service categorization directly in JIRA without needing to reference Requirements Foundry.
Output: Extended JIRA export pipeline that includes MSS service area path (L2 Service Line → L3 Service Area) in epic/story descriptions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior MSS work:
@.planning/phases/15-mss-mapping-to-work-items/15-01-SUMMARY.md
@.planning/phases/15-mss-mapping-to-work-items/15-02-SUMMARY.md
@.planning/phases/16-mss-dashboard-reporting/16-01-SUMMARY.md

# JIRA export pipeline (functional pipeline pattern):
@lib/export/jira/types.ts
@lib/export/jira/extractor.ts
@lib/export/jira/normalizer.ts
@lib/export/jira/mapper.ts
@lib/export/jira/description-templates.ts

# MSS types:
@lib/mss/types.ts

**Tech stack available:**
- Prisma with MssServiceArea relation on Epic/Story
- JIRA export pipeline (extract → normalize → map → generate)
- Description templates with markdown and wiki markup support

**Established patterns:**
- Normalizer flattens hierarchy, mapper uses description-templates for descriptions
- Epic/Story have optional mssServiceAreaId FK with mssServiceArea relation
- Stories inherit MSS from epic if no override

**Constraining decisions:**
- Phase 15: MSS stored at L3 (Service Area) level, stories inherit from epic
- Phase 16: Coverage calculated considering epic inheritance
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend extractor and types for MSS data</name>
  <files>lib/export/jira/types.ts, lib/export/jira/extractor.ts</files>
  <action>
1. In types.ts, add MSS fields to NormalizedItem:
   - mssServiceLineName?: string | null
   - mssServiceAreaName?: string | null

2. Update EpicWithRelations and StoryWithSubtasks type definitions to include mssServiceArea relation with serviceLine

3. In extractor.ts, update the Prisma query in extractExportData() to include mssServiceArea relation:
   ```
   include: {
     mssServiceArea: {
       include: { serviceLine: true }
     },
     stories: {
       include: {
         mssServiceArea: {
           include: { serviceLine: true }
         },
         subtasks: true
       }
     }
   }
   ```

Note: Keep existing query structure, just add the mssServiceArea include. The relation is optional so nulls are fine.
  </action>
  <verify>TypeScript compilation passes (npm run build)</verify>
  <done>
- NormalizedItem has mssServiceLineName and mssServiceAreaName fields
- Extractor query includes mssServiceArea with nested serviceLine
- No type errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Update normalizer to pass through MSS data</name>
  <files>lib/export/jira/normalizer.ts</files>
  <action>
1. Update normalizeEpic() function to include MSS fields:
   - mssServiceLineName: epic.mssServiceArea?.serviceLine?.name ?? null
   - mssServiceAreaName: epic.mssServiceArea?.name ?? null

2. Update normalizeStory() function to include MSS fields:
   - For stories, use story's own mssServiceArea if set, otherwise inherit from epic
   - Pass epicMssServiceArea as parameter so inheritance works:
   ```
   const effectiveMss = story.mssServiceArea ?? epicMssServiceArea;
   mssServiceLineName: effectiveMss?.serviceLine?.name ?? null
   mssServiceAreaName: effectiveMss?.name ?? null
   ```

3. Update normalizeForExport() to pass epic's mssServiceArea to story normalizer

Note: Subtasks don't need MSS fields since they always belong to a story (which has MSS context). Keep subtask normalizer unchanged.
  </action>
  <verify>npm run build passes</verify>
  <done>
- normalizeEpic extracts MSS names from relation
- normalizeStory handles inheritance (own assignment or epic's)
- MSS fields flow through to NormalizedItem
  </done>
</task>

<task type="auto">
  <name>Task 3: Add MSS section to description templates</name>
  <files>lib/export/jira/description-templates.ts</files>
  <action>
1. Add helper function to format MSS info:
   ```typescript
   function formatMssSection(item: NormalizedItem): string | null {
     if (!item.mssServiceAreaName) return null;

     const parts = [item.mssServiceLineName, item.mssServiceAreaName]
       .filter(Boolean)
       .join(" → ");

     return parts ? `**Service Area:** ${parts}` : null;
   }
   ```

2. Update formatCompactEpic() to include MSS at the top (before description):
   - Add MSS section first if present
   - Keep existing description and business value

3. Update formatFullEpic() to include MSS in a dedicated section:
   - Add "## Service Area" section after Overview if MSS is assigned

4. Update formatCompactStory() to include MSS at the top:
   - Add MSS section first if present

5. Update formatFullStory() to include MSS in a dedicated section:
   - Add "## Service Area" section after User Story section

Note: Subtasks don't need MSS section (context comes from parent story). Use the arrow format "Service Line → Service Area" for clear hierarchy.
  </action>
  <verify>npm run build passes</verify>
  <done>
- Epic descriptions include MSS service area (compact: inline, full: dedicated section)
- Story descriptions include MSS service area (with inheritance working)
- Arrow format shows hierarchy: "Cloud Services → Azure Management"
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] Create test export with MSS-assigned epic to verify description includes service area
- [ ] Verify both compact and full content levels show MSS
- [ ] Verify story inherits MSS from epic when not directly assigned
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript or lint errors introduced
- Epic descriptions show MSS service area when assigned
- Story descriptions show MSS service area (own or inherited from epic)
- MSS appears in both compact and full content level exports
</success_criteria>

<output>
After completion, create `.planning/phases/17-mss-export-integration/17-01-SUMMARY.md`:

# Phase 17 Plan 01: MSS Export Integration Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Milestone Completion

Phase 17 complete - v1.2 MSS Integration milestone COMPLETE

v1.2 delivered:
- Phase 13: MSS Data Model & Import
- Phase 14: MSS Management UI
- Phase 15: MSS Mapping to Work Items
- Phase 16: MSS Dashboard & Reporting
- Phase 17: MSS Export Integration
</output>
